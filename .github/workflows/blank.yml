name: "Build Export Templates"
on: push

jobs:
  build-export-templates:
    name: Build Android Debug
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Clone Godot Engine Source
      run: |
        git clone https://github.com/godotengine/godot.git
        cd godot
        git checkout 4.3

    - name: Install SCons
      run: |
        python3 -m pip install scons

    - name: Install MinGW
      run: |
        sudo apt-get update
        sudo apt-get install -y mingw-w64
        sudo update-alternatives --set x86_64-w64-mingw32-g++ /usr/bin/x86_64-w64-mingw32-g++-posix
  
    - name: Build Export Template Linux
      run: |
        cd godot
        scons -j 4 p=x11 target=template_release tools=no bits=64
        cp bin/godot.x11.opt.64 templates/linux_x11_64_release
        upx templates/linux_x11_64_release
    
    - name: Build Export Emcripten
      run: |
        scons -j 4 p=javascript target=template_release
        cp bin/godot.javascript.opt.html godot.html
        cp bin/godot.javascript.opt.js godot.js
        cp tools/html_fs/filesystem.js .
        zip javascript_release.zip godot.html godot.js filesystem.js
        mv javascript_release.zip templates/

    - name: Build Export Android Debug
      run: |
        scons -j 4 p=android target=template_debug
        cp bin/libgodot.android.opt.debug.so platform/android/java/libs/armeabi/libgodot_android.so
        ./gradlew build
        cp platform/android/java/build/outputs/apk/java-release-unsigned.apk templates/android_debug.apk
  
