name: "Build Export Templates"
on: push

jobs:
  build-templates:
    name: Build All Export Templates
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Clone Godot Engine Source
      run: |
        git clone https://github.com/godotengine/godot.git
        cd godot
        git checkout 4.3

    - name: Install SCons
      run: |
        python3 -m pip install scons

    - name: Install MinGW
      run: |
        sudo apt-get update
        sudo apt-get install -y mingw-w64
        sudo update-alternatives --set x86_64-w64-mingw32-g++ /usr/bin/x86_64-w64-mingw32-g++-posix

    - name: Install UPX
      run: sudo apt-get install -y upx

    - name: Build Export Template Linux
      run: |
        cd godot
        scons -j 4 p=x11 target=template_release tools=no bits=64
        ls -la bin/
        mkdir -p templates
        cp bin/godot.linuxbsd.template_release.x86_64 templates/linux_x11_64_release
        upx templates/linux_x11_64_release

    - name: Upload Linux Export Template
      uses: actions/upload-artifact@v3
      with:
        name: linux_x11_64_release
        path: godot/templates/linux_x11_64_release
